# 代码评审记录助手

一个 VS Code 扩展，专为提高代码评审效率而设计，让您直接在 VS Code 中进行代码评审和添加评论。

## 功能特性

### 🔍 快速代码选择评审
- **快捷键操作**：选中代码后使用 `Cmd+Shift+D` (Mac) 或 `Ctrl+Shift+D` (Windows/Linux) 快速打开评审面板
- **右键菜单**：选中代码后右键选择 "Review Code" 打开评审面板
- **智能检测**：仅在选中文本时激活，避免误操作

### 💬 智能评论系统
- **代码预览**：选中的代码自动显示在评审面板顶部，方便查看
- **预填充内容**：评论框中自动预填充选中的代码内容，可直接在此基础上修改和添加注释
- **自动聚焦**：打开面板后自动聚焦到评论框，光标定位到文本末尾，提升输入体验
- **一键提交**：点击评论人按钮即可快速提交评论

### 👥 动态评论人管理
- **初始评论人**：默认提供四个评论人（启涵、鹏飞、昕一、赵祥）
- **管理模式**：
  - 点击"管理评论人"按钮进入管理模式
  - 管理模式显示添加输入框和每个评论人右侧的删除按钮（×）
  - 按钮文字切换为"保存评论人"
- **添加评论人**：在管理模式下输入新评论人名称，点击"添加"按钮或按 Enter 键
- **删除评论人**：在管理模式下点击评论人按钮右侧的 × 按钮删除
- **保存更改**：点击"保存评论人"退出管理模式，保存当前评论人列表
- **防误操作**：管理模式下无法提交评论，避免误操作

### 📋 评论管理
- **评论列表**：按时间倒序显示所有评审评论（最新的在前）
- **详细信息**：每条评论包含：
  - 评论人姓名
  - 完整文件路径
  - 代码行号范围
  - 评论时间戳
  - 评论内容（支持多行）
- **批量操作**：
  - **复制评论**：点击"复制"按钮，将所有评论格式化为结构化文本并复制到剪贴板
  - **清空评论**：点击"清空"按钮，弹出确认对话框，确认后删除所有评论
- **评论格式**：复制时自动格式化为 `[序号]. [文件路径后三级] [评论内容] -- [评论人]`

### 🔄 Git 集成
- **自动检测**：自动检测已追踪文件的 Git 提交者信息
- **智能处理**：
  - 已追踪文件：显示原始提交者姓名
  - 未追踪文件：显示 "Untracked"
  - 新文件或检测失败：显示 "Unknown"
- **详细日志**：提供详细的调试日志，方便排查问题

### ✨ 用户体验优化
- **自动关闭**：提交评论成功后自动关闭面板
- **成功提示**：操作成功时显示友好的提示消息
- **错误处理**：操作失败时显示详细的错误信息
- **单例面板**：如果面板已打开，再次调用会显示现有面板而不是创建新面板

## 安装方法

1. 下载 `.vsix` 文件
2. 打开 VS Code
3. 进入扩展视图（`Ctrl+Shift+X` 或 `Cmd+Shift+X`）
4. 点击扩展面板右上角的 "..." 菜单
5. 选择 "Install from VSIX..." 并选择下载的文件

## 使用说明

### 添加评审评论

1. **选择代码**：在编辑器中选中要评审的代码
2. **打开面板**：
   - 使用快捷键：`Cmd+Shift+D` (Mac) 或 `Ctrl+Shift+D` (Windows/Linux)
   - 或右键选择 "Review Code"
3. **编辑评论**：
   - 查看预填充的代码内容
   - 在评论框中修改或添加评审意见
4. **选择评论人**：点击对应的评论人按钮提交评论
5. **完成**：评论提交成功后，面板自动关闭

### 管理评论人

1. **进入管理模式**：点击"管理评论人"按钮
2. **添加评论人**：
   - 在输入框中输入新评论人名称
   - 点击"添加"按钮或按 Enter 键
   - 重复的评论人名称会被忽略
3. **删除评论人**：点击评论人按钮右侧的 × 按钮
4. **保存更改**：点击"保存评论人"按钮退出管理模式

### 评论管理

- **查看评论**：在评审面板底部查看所有历史评论
- **复制评论**：
  - 点击"复制"按钮
  - 评论会自动格式化为结构化文本并复制到剪贴板
  - 格式示例：
    ```
    1. path/to/file.js 这是评论内容 -- 启涵
    2. another/path/file.ts 另一条评论 -- 鹏飞
    ```
- **清空评论**：
  - 点击"清空"按钮
  - 在确认对话框中点击"确定"
  - 所有评论将被永久删除（此操作不可撤销）

## 系统要求

- **VS Code**：版本 1.70.0 或更高
- **Git**：可选，用于检测提交者信息（如果不需要 Git 集成功能，可以不安装）

## 已知限制

- **Git 集成**：
  - Git 提交者检测需要文件在 git 仓库中被追踪
  - 未追踪或新文件会显示为 "Unknown" 或 "Untracked"
  - 需要文件至少有一次提交记录才能获取提交者信息
- **数据存储**：
  - 评论存储在 VS Code 的工作区状态中，仅限于当前工作区
  - 切换工作区后评论不会自动迁移
- **评论人管理**：
  - 评论人列表仅在当前面板会话中有效
  - 关闭面板后，评论人列表会重置为默认值（启涵、鹏飞、昕一、赵祥）

## 技术实现

- **存储机制**：使用 VS Code 的 `workspaceState` API 持久化存储评论数据
- **Git 集成**：使用 `simple-git` 库执行 Git 命令获取提交者信息
- **UI 框架**：使用 VS Code Webview API 创建自定义面板界面
- **唯一标识**：使用 UUID v4 为每条评论生成唯一 ID

## 更新日志

### v1.0.4
- ✅ 实现动态评论人管理功能
- ✅ 添加评论人添加/删除功能
- ✅ 优化评论人按钮 UI，合并删除按钮
- ✅ 改进错误处理和日志记录
- ✅ 修复 crypto 未定义的问题（使用 uuid 库）
- ✅ 优化用户体验，添加自动聚焦和光标定位
